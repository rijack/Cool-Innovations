<h1>Hardware</h1>

<%= render 'search_form' %>
<%= link_to 'New Hardware', "/hardwares/new?no_layout=1", :class => 'btn btn-primary pull-right mrx modal-trigger'%>


<% if @hardwares.length > 0 %>

    <% if params.fetch(:hardware, {})[:query].present? %>
        <div class="row">
          <div class="span9 mbxx">
            your search for <em><strong>"<%= params[:hardware][:query] %>"</strong></em>  returned <strong><%= pluralize(@hardwares.count, 'result') %></strong>
          </div>
        </div>
    <% end %>

    <table class="table">
      <thead>
          <tr>
            <th>Hardware Name</th>
            <th>Required pending count</th>
            <th class="actions">&nbsp;</th>
          </tr>
      </thead>
      <tbody>
      <% @hardwares.each do |hardware| %>
          <tr>
            <% if (hardware.order_lines.length > 0) %>
                <td><a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse<%= hardware.id %>"><i class="icon-plus"></i><%= hardware.name %></a></td>
            <% else %>
                <td><%= hardware.name %></td>
            <% end %>
            <td><%= number_with_delimiter(hardware.required_count(:shipped => false)) %>
            <td class="actions">
              <%= link_to 'Edit', edit_hardware_path(hardware)+"?no_layout=1", :class => 'btn btn-small modal-trigger'%>
              <%= link_to 'Delete', hardware, method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-small btn-danger' %>
            </td>
          </tr>
          <% if (hardware.order_lines.length > 0) %>
              <tr>
                <td colspan="3" class="order-line-info hide">
                  <div class="accordion-body collapse" id="collapse<%= hardware.id %>">
                    <table class="table table-bordered table-condensed">
                      <thead>
                          <tr>
                            <th>P/O #</th>
                            <th>Client</th>
                            <th>Part #</th>
                            <th>Qty</th>
                            <th>Total Qty</th>
                            <th>Due Date</th>
                            <th>Ship Date</th>
                          </tr>
                      </thead>
                      <tbody>
                        <% hardware.order_lines.each do |order_line| %>
                            <tr>
                              <td><%= order_line.order.purchase_order %></td>
                              <td><%= order_line.order.client.name %></td>
                              <td><%= order_line.part.name %></td>
                              <td><%= number_with_delimiter(order_line.quantity) %></td>
                              <td><%= number_with_delimiter(order_line.part.required_hardwares.where(:hardware_id => hardware.id)[0].quantity * order_line.quantity) %></td>
                              <td><%= order_line.due_date %></td>
                              <td><%= order_line.ship_date %></td>
                            </tr>
                        <% end %>
                      </tbody>
                    </table>

                  </div>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>

    <%= will_paginate @collection, :renderer => BootstrapPagination::Rails %>
<% else %>
    <div class="row">
      <div class="span9 mbxx">
        There are no results
      </div>
    </div>
<% end %>




